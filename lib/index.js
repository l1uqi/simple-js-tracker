!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).FSTracker=t()}(this,function(){"use strict";const a={debug:!1,url:"",method:"POST",config:null,enableDecorator:!1,enableHeatMap:!1,enableHashTracker:!1},l=function(e){var{text:e,type:t="log",debug:n=!1}=e;n&&console[t](e)},r=function(t){return Object.keys(t).forEach(e=>{void 0!==a[e]&&delete t[e]}),t},s=e=>{let t=0,n;for(var o=0;o<e.length;o++)(n=e.charCodeAt(o))<127?t++:128<=n&&n<=2047?t+=2:2048<=n&&n<=65535&&(t+=3);return!(t<2e3)};function i(e,t,n){var o,a,i=r(n),n=Object.entries(n).map(([e,t])=>e+"="+encodeURI(t)).join("&");navigator.sendBeacon&&"SEND_BEACON"===t?(o=e,a=i,a=new URLSearchParams(a),a=new Blob([a],{type:"application/x-www-form-urlencoded"}),navigator.sendBeacon(o,a)):"POST"===t||s(n)?(o=e,a=i,(t=new XMLHttpRequest).open("POST",o,!1),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Access-Control-Allow-Origin","*"),t.send(JSON.stringify(a))):(new Image).src=e+"?"+n}const c=(e,t)=>{window.addEventListener("hashchange",e=>{console.log(e)})};const o=new class{add(e){e.el.attributes["track-pid"].value,e.el.attributes["track-params"].value,console.log(e.value)}},d=new class{add(t){t.el.addEventListener("click",function(e){p({...t.binding.value,x:e.clientX,y:e.clientY})})}remove(e){e.el.removeEventListener("click",()=>{})}},u=new class{add(t){t.el.addEventListener("keyup",function(e){13===e.keyCode&&p(t.binding.value)})}remove(e){e.el.removeEventListener("keyup",()=>{})}},t={inserted:function(t,n){var e=n["arg"];e.split("|").forEach(e=>{switch(e){case"click":d.add({el:t,binding:n});break;case"keyup":u.add({el:t,binding:n});break;case"exposure":o.add({el:t})}})},unbind(t,n){var e=n["arg"];e.split("|").forEach(e=>{switch(e){case"click":d.remove({el:t,binding:n});break;case"keyup":u.remove({el:t,binding:n});break;case"exposure":o.remove({el:t,binding:n})}})}};const n=e=>{e.directive("track",t)},p=function(t){var n=JSON.parse(localStorage.getItem("fspace-tracker"))||null;if(n){var{url:o,enableHeatMap:a}=n;let e="";a&&t.x&&t.y&&(e=t.x+"."+t.y,delete t.x,delete t.y);a={...n,...t,position:e};l({text:a,debug:n.debug}),i(o,n.method,a)}};function e(e){this._init(e)}var g;return e.prototype._init=function(e){var t,n,o;e&&(t=this,o=(n=e).config,delete n.config,n=Object.assign(o,a,n),t._options=n,localStorage.setItem("fspace-tracker",JSON.stringify(n)),e.enableHashTracker)&&c()},(g=e).prototype.setConfig=function(e){e=Object.assign({},this._options,e),localStorage.setItem("fspace-tracker",JSON.stringify(e))},g.prototype.sendTracker=function(e={}){var t={...this._options,...e};l({text:e,debug:this._options.debug}),i(this._options.url,this._options.method,t)},g.prototype.initDirectives=function(e){n(e)},g.prototype.registerVueRouterEvent=function(e,t){{var r=this._options,s=t;const c=JSON.parse(localStorage.getItem("fspace-tracker"))||null;c&&e.beforeEach((e,t,n)=>{var o=(new Date).getTime(),a=localStorage.getItem("pretimestamp")||o;localStorage.setItem("pretimestamp",o);let i="";o!=a&&(i=(o-a)/1e3,l({text:`当前停留页面${i.toFixed(2)}s`,debug:r.debug})),s({to:e,from:t,secound:i},e=>{({...c,...e})}),n()})}},e});
