!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).FSTracker=t()}(this,function(){"use strict";const o={debug:!1,url:"",config:null,enableDecorator:!1,enableHeatMap:!1,enableHashTracker:!1},c=function(e){var{text:e,type:t="log",debug:n=!1}=e;n&&console[t](e)},a=(e,t)=>{window.addEventListener("hashchange",e=>{console.log(e)})};const i=new class{add(e){e.el.attributes["track-pid"].value,e.el.attributes["track-params"].value,console.log(e.value)}},r=new class{add(t){t.el.addEventListener("click",function(e){u({...t.binding.value,x:e.clientX,y:e.clientY})})}remove(e){e.el.removeEventListener("click",()=>{})}},s=new class{add(t){t.el.addEventListener("keyup",function(e){13===e.keyCode&&u(t.binding.value)})}remove(e){e.el.removeEventListener("keyup",()=>{})}},t={inserted:function(t,n){var e=n["arg"];e.split("|").forEach(e=>{switch(e){case"click":r.add({el:t,binding:n});break;case"keyup":s.add({el:t,binding:n});break;case"exposure":i.add({el:t})}})},unbind(t,n){var e=n["arg"];e.split("|").forEach(e=>{switch(e){case"click":r.remove({el:t,binding:n});break;case"keyup":s.remove({el:t,binding:n});break;case"exposure":i.remove({el:t,binding:n})}})}};function l(e,t){var t=d(t),n=new XMLHttpRequest;n.open("POST",e,!1),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("Access-Control-Allow-Origin","*"),n.send(JSON.stringify(t))}const n=e=>{e.directive("track",t)},d=function(t){return Object.keys(t).forEach(e=>{void 0!==o[e]&&delete t[e]}),t},u=function(t){var n=JSON.parse(localStorage.getItem("fspace-tracker"))||null;if(n){var{url:i,enableHeatMap:o}=n;let e="";o&&t.x&&t.y&&(e=t.x+"."+t.y,delete t.x,delete t.y);n={...n,...t,position:e,...(o=t.tracking,!(o=o.toString())&&o.length<2?{}:{page_type:o.slice(0,1),page_id:o.slice(1)})};l(i,n)}};function e(e){this._init(e)}var p;return e.prototype._init=function(e){var t,n,i;e&&(t=this,i=(n=e).config,delete n.config,n=Object.assign(i,o,n),t._options=n,localStorage.setItem("fspace-tracker",JSON.stringify(n)),e.enableHashTracker)&&a()},(p=e).prototype.setConfig=function(e){e=Object.assign({},this._options,e),localStorage.setItem("fspace-tracker",JSON.stringify(e))},p.prototype.sendTracker=function(e={}){var t={...this._options,...e};c({text:e,debug:this._options.debug}),l(this._options.url,t)},p.prototype.initDirectives=function(e){n(e)},p.prototype.registerVueRouterEvent=function(e,t){var r,s;r=this._options,s=t,e.beforeEach((e,t,n)=>{var i=(new Date).getTime(),o=localStorage.getItem("pretimestamp")||i;localStorage.setItem("pretimestamp",i);let a="";i!=o&&(a=(i-o)/1e3,c({text:`当前停留页面${a.toFixed(2)}s`,debug:r.debug})),s({to:e,from:t,secound:a},e=>{console.log(e)}),n()})},e});
