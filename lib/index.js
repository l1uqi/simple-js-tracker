!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).FSTracker=t()}(this,function(){"use strict";const i={debug:!1,url:"",method:"POST",config:null,enableDecorator:!1,enableHeatMap:!1,enableHashTracker:!1},s=function(e){var{text:e,type:t="log",debug:n=!1}=e;n&&console[t](e)},a=function(t){return Object.keys(t).forEach(e=>{void 0!==i[e]&&delete t[e]}),t},r=e=>{let t=0,n;for(var o=0;o<e.length;o++)(n=e.charCodeAt(o))<127?t++:128<=n&&n<=2047?t+=2:2048<=n&&n<=65535&&(t+=3);return!(t<2e3)},c=(e,t)=>{var n=new XMLHttpRequest;n.open("POST",e,!1),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("Access-Control-Allow-Origin","*"),n.send(JSON.stringify(t))},l=(e,t)=>{t=new URLSearchParams(t),t=new Blob([t],{type:"application/x-www-form-urlencoded"});navigator.sendBeacon(e,t)},d=function(e,t,n){var o=a(n),n=Object.entries(n).map(([e,t])=>e+"="+encodeURI(t)).join("&");navigator.sendBeacon&&"SEND_BEACON"===t?l(e,o):"POST"===t||r(n)?c(e,o):(new Image).src=e+"?"+n},u=t=>{var n=JSON.parse(localStorage.getItem("fspace-tracker"))||null;if(n){var{url:o,enableHeatMap:i}=n;let e="";i&&t.x&&t.y&&(e=t.x+"."+t.y,delete t.x,delete t.y);i={...n,...t,position:e};s({text:i,debug:n.debug}),d(o,n.method,i)}},p=(e,t)=>{window.addEventListener("hashchange",e=>{console.log(e)})};const o=new class{add(t){t.el.addEventListener("click",function(e){console.log(t.binding.value),u({...t.binding.value,x:e.clientX,y:e.clientY})})}remove(e){e.el.removeEventListener("click",()=>{})}},g=new class{add(t){t.el.addEventListener("keyup",function(e){13===e.keyCode&&u(t.binding.value)})}remove(e){e.el.removeEventListener("keyup",()=>{})}},t={inserted:function(t,n){var e=n["arg"];e.split("|").forEach(e=>{switch(e){case"click":o.add({el:t,binding:n});break;case"keyup":g.add({el:t,binding:n})}})},unbind(t,n){var e=n["arg"];e.split("|").forEach(e=>{switch(e){case"click":o.remove({el:t,binding:n});break;case"keyup":g.remove({el:t,binding:n});break;case"exposure":exp.remove({el:t,binding:n})}})}};function e(e){this._init(e)}var n;return e.prototype._init=function(e){var t,n,o;e&&(t=this,o=(n=e).config,delete n.config,n=Object.assign(o,i,n),t._options=n,localStorage.setItem("fspace-tracker",JSON.stringify(n)),e.enableHashTracker)&&p()},(n=e).prototype.setConfig=function(e){e=Object.assign({},this._options,e),localStorage.setItem("fspace-tracker",JSON.stringify(e))},n.prototype.sendTracker=function(e={}){var t,n;t=this._options,e=e,n={...t,...e},s({text:e,debug:t.debug}),d(t.url,t.method,n)},n.prototype.initDirectives=function(e){e.directive("track",t)},n.prototype.registerVueRouterEvent=function(e,t){var r,c;e=e,r=this._options,c=t,(JSON.parse(localStorage.getItem("fspace-tracker"))||null)&&e.beforeEach((e,t,n)=>{var o=(new Date).getTime(),i=localStorage.getItem("pretimestamp")||o;localStorage.setItem("pretimestamp",o);let a="";o!=i&&(a=(o-i)/1e3,s({text:`当前停留页面${a.toFixed(2)}s`,debug:r.debug})),c({to:e,from:t,secound:a},e=>{u(e)}),n()})},e});
